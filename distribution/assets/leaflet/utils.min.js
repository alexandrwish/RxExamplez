String.prototype.hashCode=function(){var a=0,c;if(0==this.length)return a;for(var b=0;b<this.length;b++)c=this.charCodeAt(b),a=(a<<5)-a+c,a&=a;return a};L.Map.addInitHook(function(){L.control.scale().addTo(this)});
L.StoreTileLayer=L.TileLayer.extend({_loadTile:function(a,c){a._layer=this;a.onerror=this._tileOnError;this._adjustTilePoint(c);var b=this.getTileUrl(c),d=this;b&&(window.callbacks||(window.callbacks={}),window.callbacks[b.hashCode()]||(window.callbacks[b.hashCode()]=function(a){var h=window.callbacks[b.hashCode()].tiles;if(h)for(var l=0;l<h.length;l++){var e=h[l];a?(e.onload=d._tileOnLoad,e.src=a):(d._addTileLoadedCallback(d,b,e,d.getName(),c),e.src=b);e._layer.setZIndex(0);e._layer.fire("tileloadstart",
    {tile:e,url:e.src})}delete window.callbacks[b.hashCode()]},window.mapletJS.getTileInCache(b,this.getName(),c.x,c.y,c.z),window.callbacks[b.hashCode()].tiles=[]),window.callbacks[b.hashCode()].tiles.push(a))},_addTileLoadedCallback:function(a,c,b,d,g){b.onload=function(){var b=document.createElement("canvas");b.width=this.width;b.height=this.height;b.getContext("2d").drawImage(this,0,0);window.mapletJS.saveTile(b.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,""),d,g.x,g.y,g.z);a._tileOnLoad.apply(this)}}});
L.TileLayer.include({getCRS:function(){return this.options._crs?this.options._crs:L.CRS.EPSG3857},getZoomOffset:function(){return"maxZoom"in this.options?18-this.options.maxZoom:0},setName:function(a){this.options._name=a},getName:function(){return this.options._name||null}});
L.Map.include({_baseLayers:{openstreetmap:function(){return L.TileLayer.openstreetmap.apply(this,arguments)},geobase:function(){return L.TileLayer.geobase.apply(this,arguments)},google:function(){return L.TileLayer.google.apply(this,arguments)},mapquest:function(){return L.TileLayer.mapQuest.apply(this,arguments)},yandex:function(){return L.TileLayer.yandex.apply(this,arguments)},nokiahere:function(){return L.TileLayer.nokiaHere.apply(this,arguments)},decarta:function(){return L.TileLayer.decarta.apply(this,
    arguments)},geoinformsputnik:function(){return L.TileLayer.geoinformsputnik.apply(this,arguments)}},translate:function(a){return a},setConfig:function(a,c){for(var b in a)c._baseLayers[b](a[b]).addTo(c);return this}});
L.Util.geoRouter=function(a,c){if(a&&a.length){for(var b=[],d=0;d<a.length;d++)b.push("loc="+a[d].lat+","+a[d].lng);this.query="http://router.project-osrm.org/viaroute?{0}".replace("{0}",b.join("&"));$.ajax({url:this.query,dataType:"json",success:function(a){a.route_geometry.length?c(L.Util.decodeRouteGeometry(a.route_geometry,6)):c(null)},error:function(){}})}};
L.Util.decodeRouteGeometry=function(a,c){c=Math.pow(10,-c);for(var b=a.length,d=0,g=0,h=0,l=[];d<b;){var e,k=0,f=0;do e=a.charCodeAt(d++)-63,f|=(e&31)<<k,k+=5;while(32<=e);g+=f&1?~(f>>1):f>>1;f=k=0;do e=a.charCodeAt(d++)-63,f|=(e&31)<<k,k+=5;while(32<=e);h+=f&1?~(f>>1):f>>1;l.push([g*c,h*c])}return l};